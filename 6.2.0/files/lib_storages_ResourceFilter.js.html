<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>lib/storages/ResourceFilter.js - OpenVeo server API for plugins</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">OpenVeo server API for plugins</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 6.2.0
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AccessError.html">AccessError</a></li>
                                <li><a href="../classes/AdvancedEmitter.html">AdvancedEmitter</a></li>
                                <li><a href="../classes/AdvancedEvent.html">AdvancedEvent</a></li>
                                <li><a href="../classes/CAS.html">CAS</a></li>
                                <li><a href="../classes/CAS1.html">CAS1</a></li>
                                <li><a href="../classes/CAS2.html">CAS2</a></li>
                                <li><a href="../classes/CAS3.html">CAS3</a></li>
                                <li><a href="../classes/CasStrategy.html">CasStrategy</a></li>
                                <li><a href="../classes/ComponentExpression.html">ComponentExpression</a></li>
                                <li><a href="../classes/ConfigExpression.html">ConfigExpression</a></li>
                                <li><a href="../classes/ConstantExpression.html">ConstantExpression</a></li>
                                <li><a href="../classes/ContentController.html">ContentController</a></li>
                                <li><a href="../classes/Controller.html">Controller</a></li>
                                <li><a href="../classes/copyTask.html">copyTask</a></li>
                                <li><a href="../classes/Database.html">Database</a></li>
                                <li><a href="../classes/database-errors.html">database-errors</a></li>
                                <li><a href="../classes/DirectiveExpression.html">DirectiveExpression</a></li>
                                <li><a href="../classes/disableCacheMiddleware.html">disableCacheMiddleware</a></li>
                                <li><a href="../classes/ElementExpression.html">ElementExpression</a></li>
                                <li><a href="../classes/EntityController.html">EntityController</a></li>
                                <li><a href="../classes/EntityProvider.html">EntityProvider</a></li>
                                <li><a href="../classes/Expression.html">Expression</a></li>
                                <li><a href="../classes/factory.html">factory</a></li>
                                <li><a href="../classes/fileSystem.html">fileSystem</a></li>
                                <li><a href="../classes/FilterExpression.html">FilterExpression</a></li>
                                <li><a href="../classes/http-errors.html">http-errors</a></li>
                                <li><a href="../classes/HttpController.html">HttpController</a></li>
                                <li><a href="../classes/imageProcessor.html">imageProcessor</a></li>
                                <li><a href="../classes/imageProcessorMiddleware.html">imageProcessorMiddleware</a></li>
                                <li><a href="../classes/InjectExpression.html">InjectExpression</a></li>
                                <li><a href="../classes/logger.html">logger</a></li>
                                <li><a href="../classes/logRequestMiddleware.html">logRequestMiddleware</a></li>
                                <li><a href="../classes/ModuleExpression.html">ModuleExpression</a></li>
                                <li><a href="../classes/MongoDatabase.html">MongoDatabase</a></li>
                                <li><a href="../classes/MultipartParser.html">MultipartParser</a></li>
                                <li><a href="../classes/ngDpTask.html">ngDpTask</a></li>
                                <li><a href="../classes/NotFoundError.html">NotFoundError</a></li>
                                <li><a href="../classes/Pilot.html">Pilot</a></li>
                                <li><a href="../classes/Plugin.html">Plugin</a></li>
                                <li><a href="../classes/PluginApi.html">PluginApi</a></li>
                                <li><a href="../classes/Provider.html">Provider</a></li>
                                <li><a href="../classes/removeTask.html">removeTask</a></li>
                                <li><a href="../classes/renameTask.html">renameTask</a></li>
                                <li><a href="../classes/ResourceFilter.html">ResourceFilter</a></li>
                                <li><a href="../classes/RouteExpression.html">RouteExpression</a></li>
                                <li><a href="../classes/SocketController.html">SocketController</a></li>
                                <li><a href="../classes/SocketNamespace.html">SocketNamespace</a></li>
                                <li><a href="../classes/SocketServer.html">SocketServer</a></li>
                                <li><a href="../classes/Storage.html">Storage</a></li>
                                <li><a href="../classes/StorageError.html">StorageError</a></li>
                                <li><a href="../classes/STRATEGIES.html">STRATEGIES</a></li>
                                <li><a href="../classes/util.html">util</a></li>
                                <li><a href="../classes/ValueExpression.html">ValueExpression</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/controllers.html">controllers</a></li>
                                <li><a href="../modules/emitters.html">emitters</a></li>
                                <li><a href="../modules/errors.html">errors</a></li>
                                <li><a href="../modules/fileSystem.html">fileSystem</a></li>
                                <li><a href="../modules/grunt.html">grunt</a></li>
                                <li><a href="../modules/imageProcessor.html">imageProcessor</a></li>
                                <li><a href="../modules/logger.html">logger</a></li>
                                <li><a href="../modules/middlewares.html">middlewares</a></li>
                                <li><a href="../modules/multipart.html">multipart</a></li>
                                <li><a href="../modules/passport.html">passport</a></li>
                                <li><a href="../modules/plugin.html">plugin</a></li>
                                <li><a href="../modules/providers.html">providers</a></li>
                                <li><a href="../modules/socket.html">socket</a></li>
                                <li><a href="../modules/storages.html">storages</a></li>
                                <li><a href="../modules/util.html">util</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: lib/storages/ResourceFilter.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

/**
 * @module storages
 */

/**
 * Defines a storage filter.
 *
 * A filter is a uniform way of filtering results common to all storages.
 * A filter can contain only one &quot;or&quot; operation, one &quot;nor&quot; operation and one &quot;and&quot; operation.
 *
 *     var filter = new ResourceFilter()
 *     .equal(&#x27;field1&#x27;, 42)
 *     .notEqual(&#x27;field2&#x27;, 42)
 *     .greaterThan(&#x27;field3&#x27;, 42)
 *     .greaterThanEqual(&#x27;field4&#x27;, 42)
 *     .in(&#x27;field5&#x27;, [42])
 *     .lesserThan(&#x27;field6&#x27;, 42)
 *     .lesserThanEqual(&#x27;field7&#x27;, 42)
 *     .regex(&#x27;field8&#x27;, /^Something/i)
 *     .search(&#x27;query&#x27;)
 *     .or([
 *       new ResourceFilter().equal(&#x27;field8&#x27;, 42),
 *       new ResourceFilter().notIn(&#x27;field9&#x27;, [42])
 *     ])
 *     .nor([
 *       new ResourceFilter().equal(&#x27;field10&#x27;, 42),
 *       new ResourceFilter().notIn(&#x27;field11&#x27;, [42])
 *     )],
 *     .and([
 *       new ResourceFilter().equal(&#x27;field12&#x27;, 42),
 *       new ResourceFilter().notIn(&#x27;field13&#x27;, [42])
 *     )];
 *
 * @class ResourceFilter
 * @constructor
 */
function ResourceFilter() {
  Object.defineProperties(this, {

    /**
     * The list of operations.
     *
     * @property operations
     * @type Array
     * @final
     */
    operations: {
      value: []
    }

  });

}

module.exports = ResourceFilter;

/**
 * The available operators.
 *
 * @property OPERATORS
 * @type Object
 * @final
 * @static
 */
ResourceFilter.OPERATORS = {
  OR: &#x27;or&#x27;,
  NOR: &#x27;nor&#x27;,
  AND: &#x27;and&#x27;,
  EQUAL: &#x27;equal&#x27;,
  NOT_EQUAL: &#x27;notEqual&#x27;,
  IN: &#x27;in&#x27;,
  NOT_IN: &#x27;notIn&#x27;,
  GREATER_THAN: &#x27;greaterThan&#x27;,
  GREATER_THAN_EQUAL: &#x27;greaterThanEqual&#x27;,
  LESSER_THAN: &#x27;lesserThan&#x27;,
  LESSER_THAN_EQUAL: &#x27;lesserThanEqual&#x27;,
  REGEX: &#x27;regex&#x27;,
  SEARCH: &#x27;search&#x27;
};
Object.freeze(ResourceFilter.OPERATORS);

/**
 * Validates the type of a value.
 *
 * @method isValidType
 * @private
 * @param {String} value The value to test
 * @param {Array} The list of authorized types as strings
 * @return {Boolean} true if valid, false otherwise
 */
function isValidType(value, authorizedTypes) {
  var valueToString = Object.prototype.toString.call(value);

  for (var i = 0; i &lt; authorizedTypes.length; i++)
    if (valueToString === &#x27;[object &#x27; + authorizedTypes[i] + &#x27;]&#x27;) return true;

  return false;
}

/**
 * Adds a comparison operation to the filter.
 *
 * @method addComparisonOperation
 * @private
 * @param {String} field The name of the field
 * @param {String|Number|Boolean|Date} value The value to compare the field to
 * @param {String} Resource filter operator
 * @param {Array} The list of authorized types as strings
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
function addComparisonOperation(field, value, operator, authorizedTypes) {
  if (!isValidType(field, [&#x27;String&#x27;])) throw new TypeError(&#x27;Invalid field&#x27;);
  if (!isValidType(value, authorizedTypes)) throw new TypeError(&#x27;Invalid value&#x27;);

  this.operations.push({
    type: operator,
    field: field,
    value: value
  });
  return this;
}

/**
 * Adds a logical operation to the filter.
 *
 * Only one logical operation can be added in a filter.
 *
 * @method addLogicalOperation
 * @private
 * @param {Array} filters The list of filters
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
function addLogicalOperation(filters, operator) {
  for (var i = 0; i &lt; filters.length; i++)
    if (!(filters[i] instanceof ResourceFilter)) throw new TypeError(&#x27;Invalid filters&#x27;);

  if (this.hasOperation(operator)) {

    // This logical operator already exists in the list of operations
    // Just add the new filters to the operator

    for (var operation of this.operations) {
      if (operation.type === operator)
        operation.filters = operation.filters.concat(filters);
    }

  } else {

    // This logical operator does not exist yet in the list of operations

    this.operations.push({
      type: operator,
      filters: filters
    });
  }

  return this;
}

/**
 * Adds an equal operation to the filter.
 *
 * @method equal
 * @param {String} field The name of the field
 * @param {String|Number|Boolean|Date} value The value to compare the field to
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
ResourceFilter.prototype.equal = function(field, value) {
  return addComparisonOperation.call(
    this,
    field,
    value,
    ResourceFilter.OPERATORS.EQUAL,
    [&#x27;String&#x27;, &#x27;Boolean&#x27;, &#x27;Date&#x27;, &#x27;Number&#x27;]
  );
};

/**
 * Adds a &quot;not equal&quot; operation to the filter.
 *
 * @method equal
 * @param {String} field The name of the field
 * @param {String|Number|Boolean|Date} value The value to compare the field to
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
ResourceFilter.prototype.notEqual = function(field, value) {
  return addComparisonOperation.call(
    this,
    field,
    value,
    ResourceFilter.OPERATORS.NOT_EQUAL,
    [&#x27;String&#x27;, &#x27;Boolean&#x27;, &#x27;Date&#x27;, &#x27;Number&#x27;]
  );
};

/**
 * Adds a &quot;greater than&quot; operation to the filter.
 *
 * @method greaterThan
 * @param {String} field The name of the field
 * @param {String|Number|Boolean|Date} value The value to compare the field to
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
ResourceFilter.prototype.greaterThan = function(field, value) {
  return addComparisonOperation.call(
    this,
    field,
    value,
    ResourceFilter.OPERATORS.GREATER_THAN,
    [&#x27;String&#x27;, &#x27;Boolean&#x27;, &#x27;Date&#x27;, &#x27;Number&#x27;]
  );
};

/**
 * Adds a &quot;greater than or equal&quot; operation to the filter.
 *
 * @method greaterThanEqual
 * @param {String} field The name of the field
 * @param {String|Number|Boolean|Date} value The value to compare the field to
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
ResourceFilter.prototype.greaterThanEqual = function(field, value) {
  return addComparisonOperation.call(
    this,
    field,
    value,
    ResourceFilter.OPERATORS.GREATER_THAN_EQUAL,
    [&#x27;String&#x27;, &#x27;Boolean&#x27;, &#x27;Date&#x27;, &#x27;Number&#x27;]
  );
};

/**
 * Adds a &quot;lesser than&quot; operation to the filter.
 *
 * @method lesserThan
 * @param {String} field The name of the field
 * @param {String|Number|Boolean|Date} value The value to compare the field to
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
ResourceFilter.prototype.lesserThan = function(field, value) {
  return addComparisonOperation.call(
    this,
    field,
    value,
    ResourceFilter.OPERATORS.LESSER_THAN,
    [&#x27;String&#x27;, &#x27;Boolean&#x27;, &#x27;Date&#x27;, &#x27;Number&#x27;]
  );
};

/**
 * Adds a &quot;lesser than equal&quot; operation to the filter.
 *
 * @method lesserThanEqual
 * @param {String} field The name of the field
 * @param {String|Number|Boolean|Date} value The value to compare the field to
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
ResourceFilter.prototype.lesserThanEqual = function(field, value) {
  return addComparisonOperation.call(
    this,
    field,
    value,
    ResourceFilter.OPERATORS.LESSER_THAN_EQUAL,
    [&#x27;String&#x27;, &#x27;Boolean&#x27;, &#x27;Date&#x27;, &#x27;Number&#x27;]
  );
};

/**
 * Adds an &quot;in&quot; operation to the filter.
 *
 * @method in
 * @param {String} field The name of the field
 * @param {Array} value The value to compare the field to
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
ResourceFilter.prototype.in = function(field, value) {
  if (!isValidType(value, [&#x27;Array&#x27;])) throw new TypeError(&#x27;Invalid value&#x27;);

  for (var i = 0; i &lt; value.length; i++)
    if (!isValidType(value[i], [&#x27;String&#x27;, &#x27;Boolean&#x27;, &#x27;Date&#x27;, &#x27;Number&#x27;])) throw new TypeError(&#x27;Invalid value&#x27;);

  return addComparisonOperation.call(this, field, value, ResourceFilter.OPERATORS.IN, [&#x27;Array&#x27;]);
};

/**
 * Adds a &quot;not in&quot; operation to the filter.
 *
 * @method in
 * @param {String} field The name of the field
 * @param {Array} value The value to compare the field to
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
ResourceFilter.prototype.notIn = function(field, value) {
  if (!isValidType(value, [&#x27;Array&#x27;])) throw new TypeError(&#x27;Invalid value&#x27;);

  for (var i = 0; i &lt; value.length; i++)
    if (!isValidType(value[i], [&#x27;String&#x27;, &#x27;Boolean&#x27;, &#x27;Date&#x27;, &#x27;Number&#x27;])) throw new TypeError(&#x27;Invalid value&#x27;);

  return addComparisonOperation.call(this, field, value, ResourceFilter.OPERATORS.NOT_IN, [&#x27;Array&#x27;]);
};

/**
 * Adds a &quot;regular expression&quot; operation to the filter.
 *
 * @method regex
 * @param {String} field The name of the field
 * @param {RegExp} value The regular expression to compare the field to
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if field and / or value is not valid
 */
ResourceFilter.prototype.regex = function(field, value) {
  return addComparisonOperation.call(
    this,
    field,
    value,
    ResourceFilter.OPERATORS.REGEX,
    [&#x27;RegExp&#x27;]
  );
};

/**
 * Adds a &quot;or&quot; operation to the filter.
 *
 * @method or
 * @param {Array} filters The list of filters
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if filters are not valid
 */
ResourceFilter.prototype.or = function(filters) {
  return addLogicalOperation.call(this, filters, ResourceFilter.OPERATORS.OR);
};

/**
 * Adds a &quot;nor&quot; operation to the filter.
 *
 * @method nor
 * @param {Array} filters The list of filters
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if filters are not valid
 */
ResourceFilter.prototype.nor = function(filters) {
  return addLogicalOperation.call(this, filters, ResourceFilter.OPERATORS.NOR);
};

/**
 * Adds an &quot;and&quot; operation to the filter.
 *
 * @method and
 * @param {Array} filters The list of filters
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if filters are not valid
 */
ResourceFilter.prototype.and = function(filters) {
  return addLogicalOperation.call(this, filters, ResourceFilter.OPERATORS.AND);
};

/**
 * Adds a &quot;search&quot; operation to the filter.
 *
 * @method search
 * @param {String} value The search query
 * @return {ResourceFilter} The actual filter
 * @throws {TypeError} An error if value is not a String
 */
ResourceFilter.prototype.search = function(value) {
  if (!isValidType(value, [&#x27;String&#x27;])) throw new TypeError(&#x27;Invalid value&#x27;);

  this.operations.push({
    type: ResourceFilter.OPERATORS.SEARCH,
    value: value
  });

  return this;
};

/**
 * Tests if an operation has already been specified.
 *
 * @method hasOperation
 * @param {String} Operation operator
 * @return {Boolean} true if the operation has already been added to this filter, false otherwise
 */
ResourceFilter.prototype.hasOperation = function(operator) {
  for (var i = 0; i &lt; this.operations.length; i++)
    if (this.operations[i].type === operator) return true;

  return false;
};

/**
 * Gets an operation from filter or sub filters.
 *
 * @method getComparisonOperation
 * @param {String} Operation operator
 * @param {String} Operation field
 * @return {Object|Null} The operation with:
 * -**String** type The operation type
 * -**String** field The operation field
 * -**String|Number|Boolean|Date** value The operation value
 */
ResourceFilter.prototype.getComparisonOperation = function(operator, field) {
  for (var i = 0; i &lt; this.operations.length; i++) {
    if ([
      ResourceFilter.OPERATORS.OR,
      ResourceFilter.OPERATORS.NOR,
      ResourceFilter.OPERATORS.AND
    ].indexOf(this.operations[i].type) &gt;= 0) {
      for (var j = 0; j &lt; this.operations[i].filters.length; j++) {
        var result = this.operations[i].filters[j].getComparisonOperation(operator, field);
        if (result) return result;
      }
    } else if (this.operations[i].type === operator &amp;&amp; (!field || this.operations[i].field === field))
      return this.operations[i];
  }

  return null;
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
